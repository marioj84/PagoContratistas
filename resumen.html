<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resumen de Tabla de SharePoint</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even){background-color: #f9f9f9;}
        tr:hover {background-color: #ddd;}
    </style>
</head>
<body>
    <h1>Resumen de la Tabla de SharePoint</h1>
    <table id="summaryTable">
        <thead>
            <tr>
                <th>Contratista</th>
                <th>OT</th>
                <th>Tipo</th>
                <th>Cantidad</th>
                <th>Descripción</th>
                <th>Monto</th>
                <th>Movilización</th>
                <th>Fecha de Carga</th>
                <th>Hora de Carga</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los datos se insertarán aquí -->
        </tbody>
    </table>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Reemplaza estos valores con los de tu entorno
            const siteUrl = "https://empresaslipigas.sharepoint.com/sites/ContratistasMedidor"; // Asegúrate de que esta sea la URL base correcta
            const listName = "Cobros";

            // Construir la URL de la API REST
            const apiUrl = `${siteUrl}/_api/web/lists/getbytitle('${listName}')/items?$select=contratista,ot,tipo,cantidad,descripcion,monto,movilizacion,FechaCarga,HoraCarga`;

            // Realizar la solicitud fetch
            fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                credentials: "include" // Asegura que las cookies de autenticación se envíen
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error en la solicitud: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                const items = data.d.results;
                const tbody = document.querySelector("#summaryTable tbody");

                items.forEach(item => {
                    const tr = document.createElement("tr");

                    // Contratista
                    const tdContratista = document.createElement("td");
                    tdContratista.textContent = item.contratista;
                    tr.appendChild(tdContratista);

                    // OT
                    const tdOt = document.createElement("td");
                    tdOt.textContent = item.ot;
                    tr.appendChild(tdOt);

                    // Tipo
                    const tdTipo = document.createElement("td");
                    tdTipo.textContent = item.tipo;
                    tr.appendChild(tdTipo);

                    // Cantidad
                    const tdCantidad = document.createElement("td");
                    tdCantidad.textContent = item.cantidad;
                    tr.appendChild(tdCantidad);

                    // Descripción
                    const tdDescripcion = document.createElement("td");
                    tdDescripcion.textContent = item.descripcion;
                    tr.appendChild(tdDescripcion);

                    // Monto
                    const tdMonto = document.createElement("td");
                    tdMonto.textContent = item.monto;
                    tr.appendChild(tdMonto);

                    // Movilización
                    const tdMovilizacion = document.createElement("td");
                    tdMovilizacion.textContent = item.movilizacion;
                    tr.appendChild(tdMovilizacion);

                    // Fecha de Carga
                    const tdFechaCarga = document.createElement("td");
                    tdFechaCarga.textContent = new Date(item.FechaCarga).toLocaleDateString();
                    tr.appendChild(tdFechaCarga);

                    // Hora de Carga
                    const tdHoraCarga = document.createElement("td");
                    tdHoraCarga.textContent = new Date(item.HoraCarga).toLocaleTimeString();
                    tr.appendChild(tdHoraCarga);

                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error("Error al obtener los datos de SharePoint:", error);
                const tbody = document.querySelector("#summaryTable tbody");
                const tr = document.createElement("tr");
                const td = document.createElement("td");
                td.colSpan = 9; // Ajusta según el número de columnas
                td.textContent = "Error al cargar los datos.";
                tr.appendChild(td);
                tbody.appendChild(tr);
            });
        });
    </script>
</body>
</html>
