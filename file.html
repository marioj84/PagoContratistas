<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago Contratistas</title>
    <!-- Estilos CSS y otros enlaces -->

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyANmPIkq2scSmoA-SGRv-tCh7WKWLcH4rQ",
          authDomain: "formulariogithub.firebaseapp.com",
          projectId: "formulariogithub",
          storageBucket: "formulariogithub.appspot.com",
          messagingSenderId: "377516389796",
          appId: "1:377516389796:web:93c39e97d017fe16093d31",
          measurementId: "G-NVGW5516Y0"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Función para enviar los datos a Firestore
        async function enviarDatosAFirebase(otData) {
            try {
                const docRef = await addDoc(collection(db, "usuarios"), {
                    datos: otData,
                    fecha: serverTimestamp()
                });
                alert(`Datos enviados correctamente. ID: ${docRef.id}`);
            } catch (error) {
                console.error("Error al enviar datos a Firebase: ", error);
                alert("Error al enviar los datos al servidor.");
            }
        }
    </script>
    <!-- Fin Firebase SDK -->
    
    <!-- Estilos y otros scripts omitidos por brevedad -->
</head>
<body>
    <!-- Encabezado, contenido principal y tabla, omitidos por brevedad -->

    <!-- Botón para enviar datos a Firestore -->
    <div class="button-group">
        <button id="enviarDatosBtn" class="azul" onclick="enviarDatosFirebase()">
            <i class="fas fa-server"></i> Enviar Datos Servidor
        </button>
    </div>

    <!-- Footer y otros elementos -->

    <script>
        let otData = []; // Aquí se guardan los datos de la tabla de OT

        // Función que se llama cuando el usuario hace clic en "Enviar Datos Servidor"
        function enviarDatosFirebase() {
            const table = document.getElementById('otTable');
            otData = [];

            // Recolectar los datos de la tabla
            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                const ot = row.cells[0].children[0].value.trim();
                const tipo = row.cells[1].children[0].value;
                const cantidad = row.cells[2].children[0].value;
                const descripcion = row.cells[3].children[0].value.trim();
                const monto = row.cells[4].children[0].value.trim();
                const movilizacion = row.cells[5].children[0].value.trim();
                const subtotal = row.cells[6].children[0].value.trim().replace('$', '');

                otData.push({ ot, tipo, cantidad, descripcion, monto, movilizacion, subtotal });
            }

            // Enviar los datos a Firestore
            if (otData.length > 0) {
                enviarDatosAFirebase(otData);
            } else {
                alert("No hay datos para enviar.");
            }
        }
    </script>
</body>
</html>
